# OpenList UA 自动切换（Chrome 扩展）

## 使用背景

使用 OpenList 把多个网盘集中挂载后，大部分网盘视频都能直接网页播放，但百度网盘经常需要把浏览器 UA 改成 `pan.baidu.com`（或后续可能更新成别的值）才能正常播放。

手动用 UA 插件来回切换很麻烦，而且会影响访问其他网盘的正常体验。

本项目做了一个 Chrome 扩展：当你在 OpenList 的“百度网盘目录”下浏览/播放时，自动对百度网盘相关请求设置指定 UA。

## 功能特点

- 基于“OpenList 本地路径关键词”识别你正在访问的网盘目录，并在需要时自动切换 UA。
- 同时覆盖百度网盘实际请求的 CDN 域名（因为 OpenList 常见的 302 重定向会让视频真实请求落到 `*.baidupcs.com` 等域名）。
- 配置页支持：
  - 预设“百度网盘”模式（默认带一组常用 CDN 域名）。
  - 在“百度网盘”模式下直接查看/覆盖 CDN 域名，并提供“一键恢复预设”。
  - “自定义”模式：可用于其他网盘/其他环境自行填写域名匹配规则。

## 技术栈

- Chrome Extension Manifest V3（MV3）。
- declarativeNetRequest 动态规则：用于按 URL 匹配修改请求头（如 User-Agent / Referer）。
- chrome.storage.local：保存配置并在配置变更后自动生效。
- Options Page（配置页面）：用于提供可视化设置入口。

## 使用平台

- 适用于 Chromium 内核浏览器（例如 Google Chrome、Microsoft Edge 等）。
- 使用场景：本地或局域网访问 OpenList（例如 `http://127.0.0.1:5244` 或其他地址），并挂载百度网盘目录。

## 安装方式（推荐：加载已解压）

1. 下载本项目代码（或 Release 的 zip），解压到一个文件夹。
2. 打开浏览器扩展管理页：`chrome://extensions/`。
3. 打开右上角“开发者模式”。
4. 点击“加载已解压的扩展程序”，选择解压后的文件夹（确保 `manifest.json` 在该文件夹根目录）。

## 使用方式

1. 安装后点击扩展图标 → 打开配置页面。
2. 新建/编辑规则：
   - **网盘类型**：选择“百度网盘”或“自定义”。
   - **OpenList 地址**：例如 `http://127.0.0.1:5244`。
   - **路径关键词**：例如 `百度网盘`、`度盘`（与 OpenList 挂载目录名称一致即可）。
   - **User-Agent**：例如 `pan.baidu.com`（按你实际需要填写）。
3. 如果你使用的是 OpenList 302 重定向播放：
   - 确保百度 CDN 域名匹配列表存在并正确（默认预设已包含常见域名）。
   - 如果百度 CDN 域名变动，可在“百度网盘”模式下勾选“允许自定义百度 CDN 域名”后直接修改，并保存生效。
4. 保存后刷新 OpenList 页面，再尝试播放百度网盘视频。

## 配置说明（关于“为什么要配 CDN 域名”）

OpenList 在 302 模式下，网页里点击播放时通常会先请求 OpenList 本地地址，然后被重定向到百度网盘的 CDN 真实地址（如 `*.baidupcs.com`）。
因此仅匹配 `127.0.0.1:5244/xxx` 并不足以影响真正的视频请求，必须同时匹配百度 CDN 域名请求，才能把 UA 改到位。

## 项目文件结构（简要）

- `manifest.json`：扩展声明、权限、入口配置。
- `background.js`：MV3 Service Worker，读取配置并生成/更新 DNR 动态规则。
- `options.html` / `options.js`：配置页面 UI 与交互逻辑（保存到 `chrome.storage.local`）。
- `popup.html` / `popup.js`：扩展弹窗入口（打开配置页）。
- `icon.png`：扩展图标。

## 免责声明

本扩展通过修改请求头来改善兼容性与可用性，请仅在你拥有访问权限的网盘内容与合法使用场景下使用。

## License

GPL-3.0. See LICENSE.
